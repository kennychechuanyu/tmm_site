---
interface NavItem {
  label: string;
  href: string;
}

interface Props {
  items: NavItem[];
}

const { items } = Astro.props;
const currentPath = Astro.url.pathname;
---

<div class="relative" id="mobile-menu-container">
  <!-- Menu Button -->
  <button
    id="mobile-menu-button"
    type="button"
    class="rounded-lg p-2 text-slate-600 hover:bg-slate-100 dark:text-slate-400 dark:hover:bg-slate-800 transition-colors"
    aria-expanded="false"
    aria-label="Toggle menu"
  >
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      stroke-width="1.5"
      stroke="currentColor"
      class="h-6 w-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
      />
    </svg>
  </button>

  <!-- Dropdown Menu -->
  <div
    id="mobile-menu-dropdown"
    class="absolute right-0 mt-2 w-48 origin-top-right rounded-xl border border-slate-200 bg-white py-2 shadow-lg dark:border-slate-700 dark:bg-slate-900 hidden"
  >
    {items.map((item) => {
      const isActive = currentPath === item.href ||
        (item.href !== "/" && currentPath.startsWith(item.href));

      return (
        <a
          href={item.href}
          class:list={[
            "block px-4 py-2 text-sm transition-colors",
            isActive
              ? "bg-navy-50 text-navy-700 dark:bg-navy-950 dark:text-navy-300"
              : "text-slate-600 hover:bg-slate-50 dark:text-slate-400 dark:hover:bg-slate-800",
          ]}
        >
          {item.label}
        </a>
      );
    })}
  </div>
</div>

<script>
  function initMobileMenu() {
    const button = document.getElementById("mobile-menu-button");
    const dropdown = document.getElementById("mobile-menu-dropdown");

    if (!button || !dropdown) return;

    let isOpen = false;

    function toggleMenu() {
      isOpen = !isOpen;
      dropdown.classList.toggle("hidden", !isOpen);
      button.setAttribute("aria-expanded", String(isOpen));
    }

    function closeMenu() {
      isOpen = false;
      dropdown.classList.add("hidden");
      button.setAttribute("aria-expanded", "false");
    }

    button.addEventListener("click", (e) => {
      e.stopPropagation();
      toggleMenu();
    });

    // Close when clicking outside
    document.addEventListener("click", (e) => {
      const container = document.getElementById("mobile-menu-container");
      if (container && !container.contains(e.target as Node)) {
        closeMenu();
      }
    });

    // Close on escape key
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        closeMenu();
      }
    });
  }

  // Run on initial load
  initMobileMenu();

  // Re-run after Astro page transitions
  document.addEventListener("astro:after-swap", initMobileMenu);
</script>
