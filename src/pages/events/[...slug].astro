---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Section from "../../components/Section.astro";
import Button from "../../components/Button.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const events = await getCollection("events");
  return events.map((event) => ({
    params: { slug: event.id },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);

const formatDate = (date: Date, endDate?: Date) => {
  const options: Intl.DateTimeFormatOptions = {
    weekday: "long",
    month: "long",
    day: "numeric",
    year: "numeric",
  };

  const start = date.toLocaleDateString("en-US", options);
  if (endDate) {
    const end = endDate.toLocaleDateString("en-US", options);
    return `${start} - ${end}`;
  }
  return start;
};

const typeColors: Record<string, string> = {
  conference: "badge-primary",
  workshop: "badge-teal",
  webinar: "badge-purple",
  meetup: "badge-amber",
};
---

<BaseLayout
  title={event.data.title}
  description={event.data.description}
  image={event.data.image}
>
  <!-- Event Header -->
  <section class="border-b border-slate-200 bg-white py-16 dark:border-slate-800 dark:bg-slate-900">
    <div class="container-wide">
      <div class="flex items-center gap-3">
        <span class={typeColors[event.data.type]}>
          {event.data.type.charAt(0).toUpperCase() + event.data.type.slice(1)}
        </span>
        {event.data.featured && (
          <span class="badge bg-navy-600 text-white dark:bg-navy-500">Featured</span>
        )}
      </div>

      <h1 class="mt-4 text-4xl font-semibold text-slate-900 dark:text-white md:text-5xl">
        {event.data.title}
      </h1>

      <div class="mt-6 flex flex-wrap gap-6 text-slate-600 dark:text-slate-400">
        <div class="flex items-center gap-2">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25M17.25 3v2.25M3 18.75V7.5a2.25 2.25 0 012.25-2.25h13.5A2.25 2.25 0 0121 7.5v11.25m-18 0A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75m-18 0v-7.5A2.25 2.25 0 015.25 9h13.5A2.25 2.25 0 0121 11.25v7.5" />
          </svg>
          <span>{formatDate(event.data.date, event.data.endDate)}</span>
        </div>
        <div class="flex items-center gap-2">
          <svg class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 11-6 0 3 3 0 016 0z" />
            <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1115 0z" />
          </svg>
          <span>{event.data.location}</span>
        </div>
      </div>

      {event.data.registrationUrl && (
        <div class="mt-8">
          <Button href={event.data.registrationUrl} external>
            Register Now
          </Button>
        </div>
      )}
    </div>
  </section>

  <!-- Event Content -->
  <Section background="white">
    <div class="mx-auto max-w-3xl">
      <div class="prose-tmm">
        <Content />
      </div>
    </div>
  </Section>

  <!-- Back Link -->
  <Section background="gray">
    <div class="text-center">
      <Button href="/events" variant="secondary">
        &larr; Back to All Events
      </Button>
    </div>
  </Section>
</BaseLayout>
