---
import PageLayout from "../../layouts/PageLayout.astro";
import Section from "../../components/Section.astro";
import { getCollection } from "astro:content";

// Get all news posts sorted by date (newest first)
const allNews = await getCollection("news");
const sortedNews = allNews.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime()
);

// Format date helper
function formatDate(date: Date): string {
  return date.toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}

// Get type badge color
function getTypeBadge(type: string): { bg: string; text: string } {
  switch (type) {
    case "meeting-notes":
      return { bg: "bg-navy-100 dark:bg-navy-900/50", text: "text-navy-700 dark:text-navy-300" };
    case "announcement":
      return { bg: "bg-teal-100 dark:bg-teal-900/50", text: "text-teal-700 dark:text-teal-300" };
    default:
      return { bg: "bg-slate-100 dark:bg-slate-800", text: "text-slate-700 dark:text-slate-300" };
  }
}
---

<PageLayout
  title="News"
  description="Updates, meeting notes, and announcements from the TMM network."
  subtitle="Updates and meeting notes from our community"
>
  <Section background="white">
    {sortedNews.length > 0 ? (
      <div class="space-y-8">
        {sortedNews.map((post) => {
          const badge = getTypeBadge(post.data.type);
          return (
            <article class="group rounded-xl border border-slate-200 bg-white p-6 shadow-sm transition-all hover:border-slate-300 hover:shadow-md dark:border-slate-700 dark:bg-slate-800/50 dark:hover:border-slate-600">
              <div class="flex flex-wrap items-center gap-3 text-sm">
                <time class="text-slate-500 dark:text-slate-400">
                  {formatDate(post.data.date)}
                </time>
                <span class={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium ${badge.bg} ${badge.text}`}>
                  {post.data.type.replace("-", " ")}
                </span>
                {post.data.featured && (
                  <span class="inline-flex items-center rounded-full bg-amber-100 px-2.5 py-0.5 text-xs font-medium text-amber-700 dark:bg-amber-900/50 dark:text-amber-300">
                    Featured
                  </span>
                )}
              </div>
              <h2 class="mt-3 text-xl font-semibold text-slate-900 dark:text-white">
                <a
                  href={`/news/${post.slug}`}
                  class="hover:text-navy-600 dark:hover:text-navy-400"
                >
                  {post.data.title}
                </a>
              </h2>
              <p class="mt-2 text-slate-600 dark:text-slate-400">
                {post.data.description}
              </p>
              <a
                href={`/news/${post.slug}`}
                class="mt-4 inline-flex items-center gap-1 text-sm font-medium text-navy-600 hover:text-navy-700 dark:text-navy-400 dark:hover:text-navy-300"
              >
                Read more
                <svg class="h-4 w-4 transition-transform group-hover:translate-x-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7" />
                </svg>
              </a>
            </article>
          );
        })}
      </div>
    ) : (
      <p class="text-slate-600 dark:text-slate-400 italic">
        No news posts yet. Check back soon!
      </p>
    )}
  </Section>
</PageLayout>
