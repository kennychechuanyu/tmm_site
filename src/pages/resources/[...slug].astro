---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Section from "../../components/Section.astro";
import Button from "../../components/Button.astro";
import { getCollection, render } from "astro:content";

export async function getStaticPaths() {
  const resources = await getCollection("resources");
  return resources
    .filter((resource) => !resource.data.externalUrl)
    .map((resource) => ({
      params: { slug: resource.id },
      props: { resource },
    }));
}

const { resource } = Astro.props;
const { Content } = await render(resource);

const categoryLabels: Record<string, string> = {
  tutorial: "Tutorial",
  paper: "Paper",
  software: "Software",
  video: "Video",
  dataset: "Dataset",
};
---

<BaseLayout
  title={resource.data.title}
  description={resource.data.description}
>
  <!-- Resource Header -->
  <section class="border-b border-slate-200 bg-white py-16 dark:border-slate-800 dark:bg-slate-900">
    <div class="container-wide">
      <span class="badge badge-primary capitalize">{categoryLabels[resource.data.category]}</span>

      <h1 class="mt-4 text-4xl font-semibold text-slate-900 dark:text-white md:text-5xl">
        {resource.data.title}
      </h1>

      <p class="mt-4 text-lg text-slate-600 dark:text-slate-400">
        {resource.data.description}
      </p>

      {resource.data.author && (
        <p class="mt-4 text-sm text-slate-500">
          By {resource.data.author}
          {resource.data.publishedDate && (
            <span>
              &middot; {resource.data.publishedDate.toLocaleDateString("en-US", {
                month: "long",
                year: "numeric",
              })}
            </span>
          )}
        </p>
      )}

      {resource.data.tags && resource.data.tags.length > 0 && (
        <div class="mt-4 flex flex-wrap gap-2">
          {resource.data.tags.map((tag) => (
            <span class="rounded bg-slate-100 px-2 py-1 text-xs text-slate-600 dark:bg-slate-800 dark:text-slate-400">
              {tag}
            </span>
          ))}
        </div>
      )}
    </div>
  </section>

  <!-- Resource Content -->
  <Section background="white">
    <div class="mx-auto max-w-3xl">
      <div class="prose-tmm">
        <Content />
      </div>
    </div>
  </Section>

  <!-- Back Link -->
  <Section background="gray">
    <div class="text-center">
      <Button href="/resources" variant="secondary">
        &larr; Back to Resources
      </Button>
    </div>
  </Section>
</BaseLayout>
